[{"apiVersion":"influxdata.com/v2alpha1","kind":"Task","metadata":{"name":"bettering-joliot-7f7001"},"spec":{"every":"1m","name":"tesla_energy.inverters","offset":"5s","query":"import \"date\"\nimport \"regexp\"\n\n\n\nfrom(bucket: \"tesla_energy\")\n    //for historical generation change start here, otherwise use -2m for previous minute final total\n    |> range(start: date.truncate(t: -2m, unit: 1m), stop: date.truncate(t: now(), unit: 1m))\n    |> filter(fn: (r) => r[\"_measurement\"] == \"strings\")\n    |> filter(fn: (r) => r[\"_field\"] =~ /.*_Power/)\n    |> map(\n        fn: (r) =>\n            ({r with _field:\n                    regexp.replaceAllString(v: r._field, r: /[A-D]([0-99])_Power/, t: \"Inverter$1\"),\n            }),\n    )\n    |> aggregateWindow(every: 1m, fn: sum, createEmpty: false)\n    |> to(bucket: \"tesla_energy\")"}}]