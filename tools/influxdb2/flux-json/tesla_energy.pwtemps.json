[{"apiVersion":"influxdata.com/v2alpha1","kind":"Task","metadata":{"name":"upbeat-lalande-3f7001"},"spec":{"every":"1m","name":"tesla_energy.pwtemps","query":"import \"date\"\n\n\nfrom(bucket: \"raw_tesla_energy\")\r\n//for historical generation change start here, otherwise use -2m for previous minute final total\r\n  |> range(start: date.truncate(t: -2m, unit: 1m), stop: date.truncate(t: now(), unit: 1m))\r\n  |> filter(fn: (r) => r[\"_measurement\"] == \"http\")\r\n  |> filter(fn: (r) => r[\"_field\"] =~ /PW[0-99]_temp/)\r\n  |> drop(columns: [\"host\", \"month\", \"url\", \"year\"])\r\n  |> aggregateWindow(every: 1m, fn: mean, createEmpty: false)\r\n  |> map(fn: (r) => ({r with _time: date.sub(d: 1m, from: r._time)}))\r\n  |> drop(columns: [\"_start\", \"_stop\"])\r\n  |> map(fn: (r) => ({r with _measurement: \"pwtemps\"}))\r\n  |> to(bucket: \"tesla_energy\")"}}]