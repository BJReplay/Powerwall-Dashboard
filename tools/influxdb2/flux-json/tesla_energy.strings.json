[{"apiVersion":"influxdata.com/v2alpha1","kind":"Task","metadata":{"name":"wondrous-galois-7f7001"},"spec":{"every":"1m","name":"tesla_energy.strings","query":"import \"date\"\nimport \"regexp\"\n\n\n\ndata =\n    from(bucket: \"raw_tesla_energy\")\n        //for historical generation change start here, otherwise use -2m for previous minute final total\n        |> range(start: date.truncate(t: -2m, unit: 1m), stop: date.truncate(t: now(), unit: 1m))\n        |> filter(fn: (r) => r[\"_measurement\"] == \"http\")\n\nwithoutnum =\n    data\n        |> filter(fn: (r) => r[\"_field\"] =~ /\\A[A-D]_.*/)\n        |> map(fn: (r) => ({r with _field: regexp.replaceAllString(v: r._field, r: /_/, t: \"0_\")}))\n\nwithnum =\n    data\n        |> filter(fn: (r) => r[\"_field\"] =~ /\\A[A-D][1-99]_.*/)\n\nunion(tables: [withoutnum, withnum])\n    |> aggregateWindow(every: 1m, fn: mean, createEmpty: false)\n    |> drop(columns: [\"host\", \"month\", \"url\", \"year\"])\n    |> map(fn: (r) => ({r with _measurement: \"strings\"}))\n    |> drop(columns: [\"_start\", \"_stop\"])\n    |> to(bucket: \"tesla_energy\")"}}]